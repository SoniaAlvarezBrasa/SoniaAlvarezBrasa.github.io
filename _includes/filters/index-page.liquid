{% capture listClose %}</ol>{% endcapture %}
{% capture olClose %}</ol></li>{% endcapture %}
{% capture liOpen %}<li class="{{ include.classLi }}">{% endcapture %}
{% capture liClose %}</li>{% endcapture %}
{% capture aOpen %}a class="{{ include.classA }}"{% endcapture %}
{% capture aClose %}</a>{% endcapture %}

{% assign list = null  %}

{% assign ch2 = content | split: '</h2>' %}
{% for c2 in ch2  %}
    {% assign ch3 = c2 | split: '</h3>' %}
    {% assign headers3 = ch2[forloop.index] | split: '</h3>' | size | minus: 1 %}

    {% for c3 in ch3 %}
        {% assign ch4 = c3 | split: '</h4>' %}
        {% assign headers4 = ch3[forloop.index] | split: '</h4>' | size | minus: 1 %}

        {% if ol3 != null %}
            {% assign list = list | append: ol3 | append: '~~~'  %}
            {% assign ol3 = null %}
        {% endif %}

        {% for c4 in ch4 %}
            {% assign ch5 = c4 | split: '</h5>' %}
            {% assign headers5 = ch4[forloop.index] | split: '</h5>' | size | minus: 1 %}

            {% if ol4 != null %}
                {% assign list = list | append: ol4 | append: '~~~' %}
                {% assign ol4 = null %}
            {% endif %}

            {% for c5 in ch5 %}
                {% assign ch6 = c5 | split: '</h6>' %}
                {% assign headers6 = ch5[forloop.index] | split: '</h6>' | size | minus: 1 %}

                {% if ol5 != null %}
                    {% assign list = list | append: ol5 | append: '~~~' %}
                    {% assign ol5 = null %}
                {% endif %}

                {% for c6 in ch6 %}
                    {% if ol6 != null %}
                        {% assign list = list | append: ol6 | append: '~~~' %}
                        {% assign ol6 = null %}
                    {% endif %}

                    {% if c6 contains '<h6 id=' %}
                        {% capture olOpen %}<ol type="{{include.olType6}}">{% endcapture %}
                        {% assign index6 = forloop.index %}
                        {% assign length6 = forloop.length | minus: 1 %}

                        {% assign priori = c6 | split: '<h6 id=' | first %}
                        {% assign header = c6 | remove: priori | remove: '<h6 id=' %}
                        {% assign href = header | split: '>' | first | strip %}
                        {% assign text = header | remove: href | remove: '>' %}
                        {% assign href = href | remove: "'" | remove: '"' | prepend: 'href="#' | append: '"' %}
                        {% assign li = liOpen | append: '<' | append: aOpen | append: href | append: '>' | append: text | append: aClose %}
                        {% if forloop.first %}
                            {% assign list = list | append: olOpen %}
                        {% endif %}
                        {% if index5 != null %}
                            {% assign li = li | append: liClose %}
                            {% if index6 == length6 %}
                                {% assign li = li | append: olClose %}
                                {% if index5 == length5 %}
                                    {% assign li = li | append: olClose %}
                                    {% if index4 == length4 %}
                                        {% assign li = li | append: olClose %}
                                        {% if index3 == length3 %}
                                            {% assign li = li | append: olClose %}
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}

                        {% assign ol6 = ol6 | append: li %}
                    {% endif %}
                {% endfor %}

                {% if c5 contains '<h5 id=' %}
                    {% capture olOpen %}<ol type="{{include.olType5}}">{% endcapture %}
                    {% assign index5 = forloop.index %}
                    {% assign length5 = forloop.length | minus: 1 %}

                    {% assign priori = c5 | split: '<h5 id=' | first %}
                    {% assign header = c5 | remove: priori | remove: '<h5 id=' %}
                    {% assign href = header | split: '>' | first | strip %}
                    {% assign text = header | remove: href | remove: '>' %}
                    {% assign href = href | remove: "'" | remove: '"' | prepend: 'href="#' | append: '"' %}
                    {% assign li = liOpen | append: '<' | append: aOpen | append: href | append: '>' | append: text | append: aClose %}
                    {% if forloop.first %}
                        {% assign list = list | append: olOpen %}
                    {% endif %}
                    {% if index4 != null %}
                        {% if headers6 < 1  %}
                            {% assign li = li | append: liClose %}
                            {% if index5 == length5 %}
                                {% assign li = li | append: olClose %}
                                {% if index4 == length4 %}
                                    {% assign li = li | append: olClose %}
                                    {% if index3 == length3 %}
                                        {% assign li = li | append: olClose %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    {% assign ol5 = ol5 | append: li %}
                {% endif %}
            {% endfor %}

            {% if c4 contains '<h4 id=' %}
                {% capture olOpen %}<ol type="{{include.olType4}}">{% endcapture %}
                {% assign index4 = forloop.index %}
                {% assign length4 = forloop.length | minus: 1 %}

                {% assign priori = c4 | split: '<h4 id=' | first %}
                {% assign header = c4 | remove: priori | remove: '<h4 id=' %}
                {% assign href = li | split: '>' | first | strip %}
                {% assign href = header | split: '>' | first | strip %}
                {% assign text = header | remove: href | remove: '>' %}
                {% assign href = href | remove: "'" | remove: '"' | prepend: 'href="#' | append: '"' %}
                {% assign li = liOpen | append: '<' | append: aOpen | append: href | append: '>' | append: text | append: aClose %}
                {% if forloop.first %}
                    {% assign list = list | append: olOpen %}
                {% endif %}
                {% if index3 != null %}
                    {% if headers5 < 1  %}
                        {% assign li = li | append: liClose %}
                        {% if index4 == length4 %}
                            {% assign li = li | append: olClose %}
                            {% if index3 == length3 %}
                                {% assign li = li | append: olClose %}
                            {% endif %%}
                        {% endif %%}
                    {% endif %}
                {% endif %}

                {% assign ol4 = ol4 | append: li %}
            {% endif %}
        {% endfor %}

        {% if c3 contains '<h3 id=' %}
            {% capture olOpen %}<ol type="{{include.olType3}}">{% endcapture %}
            {% assign index3 = forloop.index %}
            {% assign length3 = forloop.length | minus: 1 %}

            {% assign priori = c3 | split: '<h3 id=' | first %}
            {% assign header = c3 | remove: priori | remove: '<h3 id=' %}
            {% assign href = header | split: '>' | first | strip %}
            {% assign text = header | remove: href | remove: '>' %}
            {% assign href = href | remove: "'" | remove: '"' %}
            {% assign li = liOpen | append: '<' | append: aOpen | append: href | append: '>' | append: text | append: aClose %}
            {% if forloop.first %}
                {% assign list = list | append: olOpen %}
            {% endif %}
            {% if index2 != null %}
                {% if headers4 < 1 %}
                    {% assign li = li | append: liClose %}
                    {% if index3 == length3 %}
                        {% assign li = li | append: olClose %}
                    {% endif %}
                {% endif %}
            {% endif %}

            {% assign ol3 = ol3 | append: li %}
        {% endif %}
    {% endfor %}

    {% if c2 contains '<h2 id=' %}
        {% capture olOpen %}<ol class="{{include.classOl}}" type="{{include.olType2}}">{% endcapture %}
        {% assign index2 = forloop.index %}
        {% assign length2 = forloop.length | minus: 1 %}

        {% assign priori = c2 | split: '<h2 id=' | first %}
        {% assign header = c2 | remove: priori | remove: '<h2 id=' %}
        {% assign href = header | split: '>' | first | strip %}
        {% assign text = header | remove: href | remove: '>' %}
        {% assign href = href | remove: "'" | remove: '"' | prepend: 'href="#' | append: '"' %}
        {% assign li = liOpen | append: '<' | append: aOpen | append: href | append: '>' | append: text | append: aClose %}
        {% if forloop.first %}
            {% assign list = list | append: olOpen %}
        {% endif %}
        {% if headers3 < 1 %}
            {% assign li = li | append: liClose %}
            {% if index2 == length2 %}
                {% assign li = li | append: listClose %}
            {% endif %}
        {% endif %}

        {% assign list = list | append: li | append: '~~~' %}
    {% endif %}
{% endfor %}
{% assign list = list | split: '~~~' %}

{{ list }}

{% assign priori = null %} {% assign header = null %} {% assign href = null %} {% assign li = null %}

{% assign length2 = null %} {% assign length3 = null %} {% assign length4 = null %} {% assign length5 = null %} {% assign length6 = null %}

{% assign index2 = null %} {% assign index3 = null %} {% assign index4 = null %} {% assign index5 = null %} {% assign index6 = null %}

{% assign headers3 = null %} {% assign headers4 = null %} {% assign headers5 = null %} {% assign headers6 = null %}

{% assign ch2 = null %} {% assign ch3 = null %} {% assign ch4 = null %} {% assign ch5 = null %} {% assign ch6 = null %}

{% assign ol3 = null %} {% assign ol4 = null %} {% assign ol5 = null %} {% assign ol6 = null %}

{% assign  olOpen = null %} {% assign olClose = null %} {% assign liOpen = null %} {% assign liClose = null %} {% assign aOpen = null %} {% assign aClose = null %} {% assign listOpen = null %}

{% assign list = null %}

<!-- page.ref = cat.index listado de tags en una categoría -->
<!-- En la plantilla base todos los href aquí son #relativos -->
{% if include.show == "tag" %}
    <!-- post es una variable local; for post in posts -->
    {% if post.tags.size > 0 %}
    <nav>
        <ul class="{{ include.ulclass }}">
    {% if post.tags %}
            {% for tag in post.tags %}
        {% if include.iconid %}
                {% capture svgid %}
                    {{ include.iconid | strip }}--tag{{ forloop.index | strip }}
                {% endcapture %}
                {% capture iconclass %}
                    svg--{{ include.tagsvg }}
                {% endcapture %}
            <li class="svg">
                <a href="#{{ page.permalink | slugify }}--tag-{{ tag | slugify }}">
                    <span class="{{ include.spanclass }} {{ iconclass | strip }}">{% include svg/icon-{{include.tagsvg}}.svg hidden='true' iconclass=iconclass id=svgid %}</span>{{ tag | capitalize }}
                </a>
            </li>
        {% else %}
            <li class="{{ include.lielse }}"><a href="#{{ page.permalink | slugify }}--tag-{{ tag | slugify }}">{{ tag | capitalize }}</a></li>
        {% endif %}
            {% endfor %}
    {% endif %}
        </ul>
    </nav>
    <!-- Page -->
    {% elsif page.tags.size > 0 %}
    <nav>
        <ul class="{{ include.ulclass }}">
    {% if page.tags %}
            {% for tag in page.tags %}
        {% if include.iconid %}
                {% capture svgid %}
                    {{ include.iconid | strip }}--tag{{ forloop.index | strip }}
                {% endcapture %}
                {% capture iconclass %}
                    svg--{{ include.tagsvg }}
                {% endcapture %}
            <li class="svg">
                <a href="#page.tag">
                    <span class="{{ include.spanclass }} {{ iconclass | strip }}">{% include svg/icon-{{include.tagsvg}}.svg hidden='true' iconclass=iconclass id=svgid %}</span>{{ tag | capitalize }}
                </a>
            </li>
        {% else %}
            <li class="{{ include.lielse }}"><a href="#">{{ tag | capitalize }}</a></li>
        {% endif %}
            {% endfor %}
    {% endif %}
        </ul>
    </nav>
    {% endif %}
<!-- por defecto ambos -> tags y categories -->
<!-- En la plantilla base href #relativos sólo en 'cat-index'-->
{% else %}
    {% if post.tags.size > 0 or post.categories.size > 0 %}
    <nav>
        <ul class="{{ include.ulclass }}">
    <!-- post es una variable local; for post in posts -->
    {% if post.categories %}
            {% for cat in post.categories %}
        {% if include.iconid %}
                {% capture svgid %}
                    {{ include.iconid | strip }}--cat{{ forloop.index | strip }}
                {% endcapture %}
                {% capture iconclass %}
                    svg--{{ include.catsvg }}
                {% endcapture %}
            <li class="svg">
            {% if page.ref == "cat-index" %}
                <a href="#{{ page.permalink | slugify }}--cat-{{ cat | slugify }}">
            {% else %}
                {% assign pags=site.pages | where:"ref", "cat-index" | where:"lang", page.lang %}{% for pag in pags %}{% capture caturl %}{{ pag.url }}#{{ pag.url | slugify }}--cat-{{ cat | slugify }}{% endcapture %}{% endfor %}
                <a href="{{ caturl | prepend: site.url }}">
            {% endif %}
                    <span class="{{ include.spanclass }} {{ iconclass | strip }}">{% include svg/icon-{{include.catsvg}}.svg hidden='true' iconclass=iconclass id=svgid %}</span>{{ cat | capitalize }}
                </a>
            </li>
        {% else %}
            <li class="{{ include.lielse }}">
            {% if page.ref == "cat-index" %}
                <a href="#{{ page.permalink | slugify }}--cat-{{ cat | slugify }}">{{ cat | capitalize }}</a>
            {% else %}
            {% assign pags=site.pages | where:"ref", "cat-index" | where:"lang", page.lang %}{% for pag in pags %}{% capture caturl %}{{ pag.url }}#{{ pag.url | slugify }}--cat-{{ cat | slugify }}{% endcapture %}{% endfor %}
                <a href="{{ caturl | prepend: site.url }}">{{ cat | capitalize }}</a>
            {% endif %}
            </li>
        {% endif %}
            {% endfor %}
            {% assign caturl = null %}
    {% endif %}
    {% if post.tags %}
            {% for tag in post.tags %}
        {% if include.iconid %}
                {% capture svgid %}
                    {{ include.iconid | strip }}--tag{{ forloop.index | strip }}
                {% endcapture %}
                {% capture iconclass %}
                    svg--{{ include.tagsvg }}
                {% endcapture %}
            <li class="svg">
            {% if page.ref == "cat-index" %}
                <a href="#{{ page.permalink | slugify }}--tag-{{ tag | slugify }}">
            {% else %}
                {% assign pags=site.pages | where:"ref", "cat-index" | where:"lang", page.lang %}{% for pag in pags %}{% capture caturl %}{{ pag.url }}#{{ pag.url | slugify }}--tag-{{ tag | slugify }}{% endcapture %}{% endfor %}
                <a href="{{ caturl | prepend: site.url }}">
            {% endif %}
                    <span class="{{ include.spanclass }} {{ iconclass | strip }}">{% include svg/icon-{{include.tagsvg}}.svg hidden='true' iconclass=iconclass id=svgid %}</span>{{ tag | capitalize }}
                </a>
            </li>
        {% else %}
            <li class="{{ include.lielse }}">
            {% if page.ref == "cat-index" %}
                <a href="#{{ page.permalink | slugify }}--tag-{{ tag | slugify }}">{{ tag | capitalize }}</a>
            {% else %}
            {% assign pags=site.pages | where:"ref", "cat-index" | where:"lang", page.lang %}{% for pag in pags %}{% capture caturl %}{{ pag.url }}#{{ pag.url | slugify }}--cat-{{ cat | slugify }}{% endcapture %}{% endfor %}
                <a href="{{ caturl | prepend: site.url }}">{{ tag | capitalize }}</a>
            {% endif %}
            </li>
        {% endif %}
            {% endfor %}
            {% assign caturl = null %}
    {% endif %}
        </ul>
    </nav>
    {% endif %}
    <!-- Page -->
    <!-- Page ref cat-index no tiene tags ni categories -->
    <!-- Aquí el href siempre es absoluto -->
    {% if page.tags.size > 0 or page.categories.size > 0 %}
    <nav>
        <ul class="{{ include.ulclass }}">
    {% if page.categories %}
            {% for cat in page.categories %}
        {% if include.iconid %}
                {% capture svgid %}
                    {{ include.iconid | strip }}--cat{{ forloop.index | strip }}
                {% endcapture %}
                {% capture iconclass %}
                    svg--{{ include.catsvg }}
                {% endcapture %}
                {% capture href %}
                    {{ page.permalink }}#{{ page.permalink | slugify }}--cat-{{ cat | slugify }}
                {% endcapture %}
            {% assign pags=site.pages | where:"ref", "cat-index" | where:"lang", page.lang %}{% for pag in pags %}{% capture caturl %}{{ pag.url }}#{{ pag.url | slugify }}--cat-{{ cat | slugify }}{% endcapture %}{% endfor %}
            <li class="svg">
                <a href="{{ caturl | prepend: site.url }}">
                    <span class="{{ include.spanclass }} {{ iconclass | strip }}">{% include svg/icon-folder.svg hidden='true' iconclass=iconclass id=svgid %}</span>{{ cat | capitalize }}
                </a>
            </li>
        {% else %}
            <li class="{{ include.lielse }}"><a href="{{ caturl | prepend: site.url }}">{{ cat | capitalize }}</a></li>
        {% endif %}
            {% endfor %}
            {% assign caturl = null %}
    {% endif %}
    {% if page.tags %}
            {% for tag in page.tags %}
        {% if include.iconid %}
                {% capture svgid %}
                    {{ include.iconid | strip }}--tag{{ forloop.index | strip }}
                {% endcapture %}
                {% capture iconclass %}
                    svg--{{ include.tagsvg }}
                {% endcapture %}
            {% assign pags=site.pages | where:"ref", "cat-index" | where:"lang", page.lang %}{% for pag in pags %}{% capture caturl %}{{ pag.url }}#{{ pag.url | slugify }}--tag-{{ tag | slugify }}{% endcapture %}{% endfor %}
            <li class="svg">
                <a href="{{ caturl | prepend: site.url }}">
                    <span class="{{ include.spanclass }} {{ iconclass | strip }}">{% include svg/icon-tag.svg hidden='true' iconclass=iconclass id=svgid %}</span>{{ tag | capitalize }}
                </a>
            </li>
        {% else %}
            <li class="{{ include.lielse }}"><a href="{{ caturl | prepend: site.url }}">{{ tag | capitalize }}</a></li>
        {% endif %}
            {% endfor %}
            {% assign caturl = null %}
    {% endif %}
        </ul>
    </nav>
    {% endif %}
{% endif %}
